{% extends "consumers/cons_base.html" %}
{% load static %}
    
    {% block content %}
     <script>
        var offer_id="{{offer.id}}"
        var merchant_id="{{merchant.user_id}}"
        var consumer_id="{{user.id}}"
        var card_id="{{card_details.id}}" 
        var order_amount = "{{order_amount}}"
        var final_amount= "{{final_amount}}"
        console.log(offer_id)
        console.log(merchant_id)
        console.log(consumer_id)
        console.log(card_id)
    </script>

    <center>
    <h2 style="font-family: Arbutus Slab, serif; font-size: 22px; margin-top: 18px; color: #000; line-height: 1.25; text-decoration: underline;"><strong>Checkout Screen</strong></h2>
    </center>
    <div class="container-fluid background">
        <div class="row padding-top-20">
            <div class="col-12 col-sm-12 col-md-10 col-lg-10 col-xl-8 offset-md-1 offset-lg-1 offset-xl-2">
                <div class="row">
                    <div class="col-12 main-wrapper">
                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                <div id="template" class="row panel-wrapper">
                                    <div class="col-12 panel-header basket-header">
                                        <div class="row">
                                            <div class="col-6 basket-title">
                                                <span class="description">review your</span><br><span class="emphasized">Order Summary</span>
                                            </div>
                                            <div class="col-6 order-number align-right">
                                                <span class="description">order id#</span><br><span class="emphasized">{{offer.id}}</span>
                                            </div>
                                        </div>                      
                                    </div>
                                    <div class="col-12 panel-body basket-body">
                                        <div class="row product">
                                            <div class="col-2 product-image"><img src="https://img.icons8.com/fluent/48/000000/shopping-cart.png"/></div>
                                            <div class="col-5">{{offer.offer_name}}<br><span class="additional">{{offer.details}}</span></div>
                                            <div class="col-2 align-right"><span class="sub">Karma Points:</span> {{offer.karma_points_required}}</div>
                                            <div class="col-3 align-right"><span class="sub"></span>{{offer.percentage_off}}</div>
                                        </div>
                                    </div>
                                    <div class="col-12 panel-footer basket-footer">
                                        <hr>
                                        <div class="row">
                                            <div class="col-8 align-right description"><div class="dive">Subtotal</div></div>
                                            <div class="col-4 align-right"><span class="emphasized">{{order_amount}}</span></div>
                                            <div class="col-8 align-right description"><div class="dive">Discount</div></div>
                                            <div class="col-4 align-right"><span class="emphasized">{{taxes}}</span></div>
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col-8 align-right description"><div class="dive">Total</div></div>
                                            <div class="col-4 align-right"><span class="very emphasized">{{final_amount}}</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                                <div class="row">
                                    <div class="col-12 panel-header creditcard-header">
                                        <div class="row">
                                            <div class="col-12 creditcard-title">
                                                <span class="description">select card</span><br><span class="emphasized">Powered by VisaDirect</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 panel-body creditcard-body">
                                        <div class="card flex-md-row mb-4 shadow-sm h-md-250">
                                            <div class="card-body d-flex flex-column align-items-start">
                                              <!-- radio button style cards-->
                                              <div class="row">
                      
                                                  <div>
                                                      <label class="credit-card-label">
                                                      <input type="radio" checked="checked" name="product" class="card-input-element" />
                                                      <div class="panel panel-default card-input">
                                                          <div class="panel-heading">Card 1</div>
                                                          <div class="panel-body">
                                                              **** **** **** 0549
                                                              <br/>
                                                              Valid thru 01/22
                                                          </div>
                                                      </div>
                                                    </label>
                                                  </div>
                  
                                                  <div>
                                                      <label class="credit-card-label">
                                                      <input type="radio" name="product" class="card-input-element" />
                                                      <div class="panel panel-default card-input">
                                                          <div class="panel-heading">Card 2</div>
                                                          <div class="panel-body">
                                                              **** **** **** 2374
                                                              <br/>
                                                              Valid thru 04/21
                                                          </div>
                                                      </div>
                                                      </label>
                                                  </div>
                  
                                                  <div>
                                                      <label class="credit-card-label">
                                                      <input type="radio" name="product" class="card-input-element" />
                                                      <div class="panel panel-default card-input">
                                                          <div class="panel-heading">Card 3</div>
                                                          <div class="panel-body">
                                                              **** **** **** 1109
                                                              <br/>
                                                              Valid thru 10/22
                                                          </div>
                                                      </div>
                                                    </label>
                                                  </div>
                  
                                              </div>
                                              <!-- end radio button style cards-->
                                            </div>
                                          </div>
                                    </div>
                                    <div class="col-12 panel-footer creditcard-footer">
                                        <div class="row">
                                            <div class="col-12 align-right"><button class="cancel">Cancel</button>&nbsp;<button class="confirm" id="proceed_to_payment">Confirm & Pay</button></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}
    {% block scripts %}
    <style>
        @import url("https://fonts.googleapis.com/css?family=Arbutus+Slab|Open+Sans&display=swap");
        body {
            background: #b5ced8;
        }

.main-wrapper
{
    border-radius: 15px 15px 15px 15px;
    -moz-border-radius: 15px 15px 15px 15px;
    -webkit-border-radius: 15px 15px 15px 15px;
    border: none;
    -webkit-box-shadow: 0px 20px 10px 10px rgba(0,0,0,0.1);
    -moz-box-shadow: 0px 20px 10px 10px rgba(0,0,0,0.1);
    box-shadow: 0px 20px 10px 10px rgba(0,0,0,0.1);
    font-size: 62.5%;
}

.basket-header
{
    border-radius: 15px 0 0 0;
    -moz-border-radius: 15px 0 0 0;
    -webkit-border-radius: 15px 0 0 0;
    padding-left: 25px !important;
}

.creditcard-header
{
    border-radius: 0 15px 0 0;
    -moz-border-radius: 0 15px 0 0;
    -webkit-border-radius: 0 15px 0 0;
    padding-left: 35px !important;
}

.panel-header
{
    background: #192061;
    height: 80px;
    padding: 15px 20px 0 20px;
}

.panel-wrapper .basket-header .column-titles
{
    color: #A2C6DD;
    padding: 0;
    margin: 0;
    /* font-family: 'Anton', sans-serif; */
    display: none;
    visibility: hidden;
}

.fix-overflow
{
    padding-right: 5px !important;
}

.panel-wrapper .basket-body
{
    overflow-x: hidden;
    overflow-y: auto;
}

.panel-wrapper .creditcard-body
{
    padding: 30px 40px 0 40px;
}

.panel-wrapper .panel-body
{
    font-weight: 400;
    font-size: 1.2em;
    outline: none !important;
    min-height: 350px;
    max-height: 350px;
}

.basket-body
{
    background: #F9F9F9;
}

.creditcard-body
{
    background: white;
}

.basket-body .row.product
{
    margin: 5px 0 5px 0;
    padding:  5px 0 5px 0;
    border-bottom: solid 1px #eeeeee;
}

.basket-body .row.product div
{
    color: #777879;
    padding: 0 10px 0 10px;
}

.basket-body .row.product .product-image
{
}

.product-image img
{
    -o-object-fit: contain;
    object-fit: contain;
    width: 100%;
    min-width: 100%;
    max-width: 100%;
    max-height: 80px;
}

.card-wrapper
{
    height: 100%;
}

.padding-top-10
{
    padding-top: 10px !important;
}

.padding-top-20
{
    padding-top: 20px !important;
}

.padding-horizontal-40
{
    padding: 0 40px 0 40px;
}

.align-right
{
    text-align: right;
}

.align-center
{
    text-align: center;
}

.emphasized
{
    /* font-family: 'Anton', sans-serif; */
    /* font-family: 'Roboto Condensed', sans-serif; */
    /* font-family: 'Raleway', sans-serif; */
    font-family: 'Open Sans', sans-serif;
    font-weight: 600;
    font-size: 1.6em;
    color: white;
}

.description
{
    /* font-family: 'Anton', sans-serif; */
    /* font-family: 'Roboto Condensed', sans-serif; */
    /* font-family: 'Raleway', sans-serif; */
    font-family: 'Open Sans', sans-serif;
    font-weight: 400;
    font-size: 1.2em;
    color: #A2C6DD;
}

.panel-footer
{
    padding-top: 10px;
    height: 150px;
}

.basket-footer
{
    background: #192061;
    border-radius: 0 0 0 15px;
    -moz-border-radius: 0 0 0 15px;
    -webkit-border-radius: 0 0 0 15px;
}

.creditcard-footer
{
    background: white;
    border-radius: 0 0 15px 0;
    -moz-border-radius: 0 0 15px 0;
    -webkit-border-radius: 0 0 15px 0;
    padding: 75px 30px 0 30px;
}

.panel-footer hr
{
    margin: 3px 0 3px 0;
    display: block;
    height: 1px;
    border: 0;
    border-top: 1px solid #197fb3;
    padding: 0;
}

.panel-footer button
{
    border: solid 1px #192061;
    background: #192061;
    font-family: 'Open Sans', sans-serif;
    font-weight: 600;
    color: white;
    font-size: 1.3em;
    text-transform: uppercase;
    padding: 10px 15px 11px 15px;
    border-radius: 5px;
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
}

.panel-footer button:hover
{
    cursor: pointer;
}

button.cancel
{
    background: white;
    color: #192061;
}

button.cancel:hover
{
    background: #ff0000;
    border-color: #ff0000;
    color: white;
}

button.confirm:hover
{
    background: #00b300;
    border-color: #00b300;
    color: white;
}

.dive
{
    margin-top: 5px;
}

.sub
{
    font-size: 75%;
    color: #aaaaaa;
}

.very
{
    font-size: 2.2em;
}

.creditcard-body form
{
    font-size: 1.3em;
}
 
.creditcard-body form i.fa
{
    margin-right: 10px;
    color: #192061;
}

.creditcard-body form fieldset
{
    border-bottom: dotted 2px #D0D0D0;
    margin-bottom: 25px;
}

.creditcard-body form input
{
    border: none;
    font-weight: 600;
    color: #555555;
    width: 85%;
    outline: none;
}

.creditcard-body form input::placeholder
{
    color: #D0D0D0;
}

.creditcard-body form label
{
    color:  #aaaaaa;
}

.additional
{
    font-weight: 300;
    font-size: 80%;
}

.fa-info-circle
{
    color: #aaaaaa !important;
}

span.month.focused.active
{
    background: #192061 !important;
    background-image: none !important;
}


@media (max-width: 992px)
{
}

@media (max-width: 767px)
{
    
    .basket-header
    {
        border-radius: 15px 15px 0 0;
        -moz-border-radius: 15px 15px 0 0;
        -webkit-border-radius: 15px 15px 0 0;
    }
    
    .basket-footer
    {
        background: #192061;
        border-radius: 0;
        -moz-border-radius: 0;
        -webkit-border-radius: 0;
    }    
    
    .creditcard-header
    {
        border-radius: 0;
        -moz-border-radius: 0;
        -webkit-border-radius: 0;
    }
    
    .creditcard-footer
    {
        border-radius: 0 0 15px 15px;
        -moz-border-radius: 0 0 15px 15px;
        -webkit-border-radius: 0 0 15px 15px;
    }
    
}

    </style>
    <script>

    $('#proceed_to_payment').on('click', function(e) {
      $.ajax({
          type: "POST",
          url: "/payment/process_payment/",
          data: {
                  offer_id:offer_id,
                  merchant_id:merchant_id,
                  user_id:consumer_id,
                  card_details_id:card_id,
                  order_amount:order_amount,
                  final_amount:final_amount,
                  csrfmiddlewaretoken: '{{ csrf_token }}'
                },
          success: function(response) {
              console.log(response)
              window.location.href="/customer/payment_success"
          },
          error: function() {
              alert('Error');
          }
      });
      return false;
  });

    $('[data-toggle="tooltip"]').tooltip();
    var template = $( '#template' ).html ();
    Mustache.parse ( template );
    var rendered = Mustache.render ( template, get_basket () );
    $( '#template' ).html ( rendered );
    if ( $('.basket-body').hasScrollBar () )
    {
        $('.column-titles').addClass('fix-overflow');
        $('.basket-body').niceScroll({autohidemode: false,cursorcolor:"#ffffff",cursorborder:"1px solid #D0D0D0",cursorborderradius: "0",background: "#ffffff"});
    }
    else
    {
        $('.column-titles').removeClass('fix-overflow');
    }
    
    $('.card-expiration').datepicker({
    format: "mm/yyyy",
    startView: "months", 
    minViewMode: "months"        
});
    </script>
    {% endblock %}